
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TG WinArena - Ultimate Casino Experience</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- TON Connect SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <!-- Chart.js for Admin Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Bebas+Neue&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #FFD700;
            --secondary-color: #FFA500;
            --accent-color: #FF6B6B;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --dark-bg: #0a0a0a;
            --light-bg: #1a1a1a;
            --card-bg: #1a1a2e;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #333333;
            --shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
            --shadow-lg: 0 8px 40px rgba(255, 215, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            --gradient-secondary: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-casino: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --border-radius: 16px;
            --border-radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 165, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Animated Background */
        .casino-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        }

        .casino-bg::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="100" fill="rgba(255,215,0,0.03)">ðŸŽ°</text></svg>') repeat;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(0%, 0%) rotate(360deg); }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(26, 26, 46, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }

        .logo i {
            font-size: 28px;
        }

        .header-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--gradient-primary);
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
            color: var(--dark-bg);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--card-bg) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
            color: var(--text-primary);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 215, 0, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .loading-subtext {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* Screens */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Cards */
        .card {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
        }

        /* Search and Categories */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-btn {
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 12px 16px;
            color: var(--dark-bg);
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .categories-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            margin-bottom: 20px;
            padding-bottom: 5px;
        }

        .category-chip {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 16px;
            white-space: nowrap;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .category-chip.active,
        .category-chip:hover {
            background: var(--gradient-primary);
            color: var(--dark-bg);
            border-color: var(--primary-color);
        }

        .sort-options {
            margin-bottom: 20px;
        }

        .sort-options select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 10px;
            color: var(--text-primary);
            width: 100%;
        }

        /* Casino Games Grid */
        .casino-games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .casino-game-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .casino-game-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .casino-game-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .casino-game-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .casino-game-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .casino-game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 12px;
        }

        .casino-game-players {
            color: var(--warning-color);
        }

        .casino-game-rtp {
            color: var(--success-color);
        }

        /* Buttons */
        .btn {
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 12px 24px;
            color: var(--dark-bg);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: var(--dark-bg);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #f57c00 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #d32f2f 100%);
            color: white;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            padding: 10px 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-item.active,
        .nav-item:hover {
            color: var(--primary-color);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 12px;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius-sm);
            padding: 16px 20px;
            color: var(--text-primary);
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
            z-index: 1000;
            max-width: 300px;
        }

        .toast.success {
            border-left-color: var(--success-color);
        }

        .toast.error {
            border-left-color: var(--danger-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Check-in Modal */
        .checkin-progress {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .day-item {
            text-align: center;
        }

        .day-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
            font-weight: 600;
        }

        .day-circle.pending {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
        }

        .day-circle.completed {
            background: var(--gradient-success);
            color: white;
        }

        .day-circle.current {
            background: var(--gradient-primary);
            color: var(--dark-bg);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .day-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .checkin-reward {
            background: rgba(255, 215, 0, 0.1);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: var(--primary-color);
        }

        /* Game Container */
        .game-container {
            background: rgba(26, 26, 46, 0.9);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Game Controls */
        .game-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .bet-amount-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 8px 12px;
            flex: 1;
        }

        .bet-amount-input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-weight: 600;
            width: 100%;
        }

        .bet-amount-input:focus {
            outline: none;
        }

        .bet-quick-select {
            display: flex;
            gap: 8px;
        }

        .bet-quick-btn {
            padding: 8px 12px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius-sm);
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: var(--transition);
        }

        .bet-quick-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .game-stat {
            text-align: center;
        }

        .game-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            font-family: 'Orbitron', sans-serif;
        }

        .game-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: 15px;
            }

            .casino-games-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .header-content {
                padding: 0 10px;
            }

            .logo {
                font-size: 16px;
            }

            .logo i {
                font-size: 20px;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="casino-bg"></div>
    
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Welcome to TG WinArena</div>
            <div class="loading-subtext">Loading your ultimate casino experience...</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-dice"></i>
                <span>TG WinArena</span>
            </div>
            <div class="header-balance">
                <i class="fas fa-coins"></i>
                <span id="userBalance">0 BTX</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Home Screen -->
        <div class="screen active" id="homeScreen">
            <div class="search-container">
                <input type="text" class="search-input" id="gameSearch" placeholder="Search casino games...">
                <button class="search-btn" onclick="searchGames()">
                    <i class="fas fa-search"></i>
                </button>
            </div>

            <div class="categories-container" id="categoriesContainer">
                <div class="category-chip active" onclick="filterByCategory('all')">All Games</div>
                <div class="category-chip" onclick="filterByCategory('casino')">Casino</div>
                <div class="category-chip" onclick="filterByCategory('card')">Card Games</div>
                <div class="category-chip" onclick="filterByCategory('dice')">Dice Games</div>
                <div class="category-chip" onclick="filterByCategory('popular')">Popular</div>
                <div class="category-chip" onclick="filterByCategory('new')">New</div>
            </div>

            <div class="sort-options">
                <select class="form-input" id="sortSelect" onchange="sortGames()">
                    <option value="popular">Most Popular</option>
                    <option value="rtp">Highest RTP</option>
                    <option value="new">New Games</option>
                    <option value="trending">Trending</option>
                </select>
            </div>

            <div class="casino-games-grid" id="gamesList">
                <!-- Games will be loaded here -->
            </div>
        </div>

        <!-- Discover Screen -->
        <div class="screen" id="discoverScreen">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-edit"></i>
                    Create Post
                </div>
                <textarea class="form-input" id="postContent" placeholder="Share your casino wins and strategies..." rows="3"></textarea>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-outline btn-sm" onclick="document.getElementById('imageUpload').click()">
                        <i class="fas fa-image"></i>
                        Add Image
                    </button>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                </div>
                <button class="btn" onclick="createPost()">
                    <i class="fas fa-paper-plane"></i>
                    Post
                </button>
            </div>
            <div id="postsList">
                <!-- Posts will be loaded here -->
            </div>
        </div>

        <!-- Earn Screen -->
        <div class="screen" id="earnScreen">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-ad"></i>
                    Watch Ads for BTX
                </div>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Watch 30-second video ads to earn 0.10 BTX each. Complete tasks for higher rewards!
                </p>
                <button class="btn btn-success" onclick="watchAd()">
                    <i class="fas fa-play"></i>
                    Watch Ad (0.10 BTX)
                </button>
                <div class="game-info" style="margin-top: 20px;">
                    <div class="game-stat">
                        <div class="game-stat-value" id="adsToday">0</div>
                        <div class="game-stat-label">Today</div>
                    </div>
                    <div class="game-stat">
                        <div class="game-stat-value" id="adsWeek">0</div>
                        <div class="game-stat-label">This Week</div>
                    </div>
                    <div class="game-stat">
                        <div class="game-stat-value" id="adsTotal">0</div>
                        <div class="game-stat-label">Total</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-tasks"></i>
                    Complete Tasks
                </div>
                <div id="tasksList">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Wallet Screen -->
        <div class="screen" id="walletScreen">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-wallet"></i>
                    TON Wallet
                </div>
                <div id="walletConnection">
                    <!-- Wallet connection status -->
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-exchange-alt"></i>
                    Quick Actions
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn" onclick="deposit()">
                        <i class="fas fa-plus"></i>
                        Deposit
                    </button>
                    <button class="btn btn-outline" onclick="withdraw()">
                        <i class="fas fa-minus"></i>
                        Withdraw
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    Transaction History
                </div>
                <div id="transactionsList">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Profile Screen -->
        <div class="screen" id="profileScreen">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-user"></i>
                    Profile
                </div>
                <div id="profileInfo">
                    <!-- Profile info will be loaded here -->
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-line"></i>
                    Statistics
                </div>
                <div id="profileStats">
                    <!-- Statistics will be loaded here -->
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-cog"></i>
                    Settings
                </div>
                <div id="profileSettings">
                    <!-- Settings will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Game Container -->
        <div class="game-container" id="gameContainer" style="display: none;">
            <!-- Game content will be loaded here -->
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <div class="nav-item active" onclick="showScreen('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="showScreen('discover')">
                <i class="fas fa-compass"></i>
                <span>Discover</span>
            </div>
            <div class="nav-item" onclick="showScreen('earn')">
                <i class="fas fa-coins"></i>
                <span>Earn</span>
            </div>
            <div class="nav-item" onclick="showScreen('wallet')">
                <i class="fas fa-wallet"></i>
                <span>Wallet</span>
            </div>
            <div class="nav-item" onclick="showScreen('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
        </div>
    </nav>

    <!-- Daily Check-in Modal -->
    <div class="modal" id="checkinModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-calendar-check"></i>
                Daily Check-in
            </div>
            <div class="checkin-progress" id="checkinProgress">
                <!-- Progress days will be generated here -->
            </div>
            <div class="checkin-reward" id="checkinReward">
                <!-- Reward will be displayed here -->
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="claimCheckinReward()">
                    <i class="fas fa-gift"></i>
                    Claim Reward
                </button>
                <button class="btn btn-outline" onclick="closeCheckinModal()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyYOUR_API_KEY_HERE",
            authDomain: "tgwinarena-app.firebaseapp.com",
            databaseURL: "https://tgwinarena-app-default-rtdb.firebaseio.com",
            projectId: "tgwinarena-app",
            storageBucket: "tgwinarena-app.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456789012345"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Global Variables
        let telegram = window.Telegram.WebApp;
        let currentUser = null;
        let tonConnectUI = null;
        let currentScreen = 'home';
        let currentGame = null;
        let userSettings = {
            sound: true,
            notifications: true,
            darkMode: false
        };

        // Game RTP settings (can be controlled from admin panel)
        const gameRTP = {
            roulette: 97.3,
            mines: 95.0,
            'dragon-tower': 96.5,
            plinko: 98.0,
            dice: 95.5,
            'dragon-tiger': 96.0
        };

        // Games Data
        const gamesData = [
            {
                id: 'roulette',
                title: 'Roulette',
                description: 'Classic wheel of fortune',
                icon: 'ðŸŽ°',
                category: 'casino',
                players: '1.2K playing',
                rtp: 97.3,
                new: false,
                popular: true
            },
            {
                id: 'mines',
                title: 'Mines',
                description: 'Avoid the mines and win',
                icon: 'ðŸ’£',
                category: 'casino',
                players: '856 playing',
                rtp: 95.0,
                new: false,
                popular: true
            },
            {
                id: 'dragon-tower',
                title: 'Dragon Tower',
                description: 'Climb the dragon tower',
                icon: 'ðŸ‰',
                category: 'casino',
                players: '623 playing',
                rtp: 96.5,
                new: true,
                popular: false
            },
            {
                id: 'plinko',
                title: 'Plinko',
                description: 'Drop and win big',
                icon: 'ðŸŽ¯',
                category: 'casino',
                players: '945 playing',
                rtp: 98.0,
                new: false,
                popular: true
            },
            {
                id: 'dice',
                title: 'Dice',
                description: 'Roll the dice',
                icon: 'ðŸŽ²',
                category: 'dice',
                players: '432 playing',
                rtp: 95.5,
                new: false,
                popular: false
            },
            {
                id: 'dragon-tiger',
                title: 'Dragon Tiger',
                description: 'Card battle game',
                icon: 'ðŸƒ',
                category: 'card',
                players: '789 playing',
                rtp: 96.0,
                new: true,
                popular: false
            }
        ];

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialize Telegram WebApp
            telegram.ready();
            telegram.expand();
            
            // Get user data from Telegram
            currentUser = telegram.initDataUnsafe?.user;
            
            if (currentUser) {
                initializeUser();
            } else {
                showToast('Please open this app from Telegram', 'error');
                setTimeout(() => {
                    telegram.close();
                }, 3000);
                return;
            }

            // Initialize TON Connect
            initializeTonConnect();

            // Load initial data
            loadGames();
            loadPosts();
            loadTasks();
            updateStats();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 2000);
        }

        function initializeUser() {
            const userId = currentUser.id;
            const userRef = database.ref('users/' + userId);

            userRef.once('value').then((snapshot) => {
                if (!snapshot.exists()) {
                    // Create new user
                    const newUser = {
                        id: userId,
                        name: currentUser.first_name + ' ' + (currentUser.last_name || ''),
                        username: currentUser.username || '',
                        photo_url: currentUser.photo_url || '',
                        balance: 0,
                        level: 1,
                        joined: new Date().toISOString(),
                        lastCheckin: null,
                        checkinStreak: 0,
                        totalEarned: 0,
                        referrals: [],
                        walletConnected: false,
                        walletAddress: null,
                        settings: userSettings,
                        statistics: {
                            gamesPlayed: 0,
                            adsWatched: 0,
                            tasksCompleted: 0,
                            postsCreated: 0
                        },
                        gameStats: {
                            roulette: { wins: 0, losses: 0, totalBet: 0 },
                            mines: { wins: 0, losses: 0, totalBet: 0 },
                            'dragon-tower': { wins: 0, losses: 0, totalBet: 0 },
                            plinko: { wins: 0, losses: 0, totalBet: 0 },
                            dice: { wins: 0, losses: 0, totalBet: 0 },
                            'dragon-tiger': { wins: 0, losses: 0, totalBet: 0 }
                        }
                    };

                    userRef.set(newUser).then(() => {
                        currentUser = { ...currentUser, ...newUser };
                        updateUserInterface();
                        checkDailyCheckin();
                    });
                } else {
                    currentUser = { ...currentUser, ...snapshot.val() };
                    updateUserInterface();
                    checkDailyCheckin();
                }
            }).catch((error) => {
                console.error('Error initializing user:', error);
                showToast('Failed to load user data', 'error');
            });
        }

        function initializeTonConnect() {
            tonConnectUI = new TON_CONNECT_UI({
                manifestUrl: 'https://tgwinarena.example.com/tonconnect-manifest.json',
                buttonRootId: null
            });
        }

        function updateUserInterface() {
            // Update balance
            document.getElementById('userBalance').textContent = `${currentUser.balance || 0} BTX`;
            
            // Update profile
            updateProfileSection();
        }

        function updateProfileSection() {
            const profileInfo = document.getElementById('profileInfo');
            if (profileInfo) {
                profileInfo.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <img src="${currentUser.photo_url || 'https://via.placeholder.com/80'}" 
                             style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px;">
                        <h3 style="color: var(--text-primary); margin-bottom: 5px;">${currentUser.name}</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">@${currentUser.username}</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div style="color: var(--primary-color); font-weight: 600;">Level ${currentUser.level}</div>
                            <div style="color: var(--text-secondary); font-size: 12px;">Level</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div style="color: var(--primary-color); font-weight: 600;">${currentUser.totalEarned || 0}</div>
                            <div style="color: var(--text-secondary); font-size: 12px;">Total Earned</div>
                        </div>
                    </div>
                `;
            }
        }

        function loadGames() {
            const gamesList = document.getElementById('gamesList');
            if (!gamesList) return;

            gamesList.innerHTML = '';
            
            gamesData.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'casino-game-card';
                gameCard.onclick = () => openGame(game.id);
                
                gameCard.innerHTML = `
                    <div class="casino-game-icon">${game.icon}</div>
                    <div class="casino-game-title">${game.title}</div>
                    <div class="casino-game-description">${game.description}</div>
                    <div class="casino-game-stats">
                        <span class="casino-game-players">ðŸ”¥ ${game.players}</span>
                        <span class="casino-game-rtp">RTP: ${game.rtp}%</span>
                    </div>
                    <button class="btn btn-sm">
                        <i class="fas fa-play"></i>
                        Play Now
                    </button>
                `;
                
                gamesList.appendChild(gameCard);
            });
        }

        function openGame(gameType) {
            currentGame = gameType;
            
            // Hide home screen and show game container
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameContainer').style.display = 'block';
            
            // Load game based on type
            switch(gameType) {
                case 'roulette':
                    showRouletteGame();
                    break;
                case 'mines':
                    showMinesGame();
                    break;
                case 'dragon-tower':
                    showDragonTowerGame();
                    break;
                case 'plinko':
                    showPlinkoGame();
                    break;
                case 'dice':
                    showDiceGame();
                    break;
                case 'dragon-tiger':
                    showDragonTigerGame();
                    break;
            }
        }

        function showRouletteGame() {
            const gameContainer = document.getElementById('gameContainer');
            gameContainer.innerHTML = `
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-circle-notch"></i>
                        Roulette
                    </div>
                    
                    <div class="game-controls">
                        <div class="bet-amount-container">
                            <input type="number" class="bet-amount-input" id="rouletteBet" value="10" min="1" max="${currentUser.balance || 0}">
                            <span>BTX</span>
                        </div>
                        <div class="bet-quick-select">
                            <button class="bet-quick-btn" onclick="setRouletteBet(10)">10</button>
                            <button class="bet-quick-btn" onclick="setRouletteBet(25)">25</button>
                            <button class="bet-quick-btn" onclick="setRouletteBet(50)">50</button>
                            <button class="bet-quick-btn" onclick="setRouletteBet(100)">100</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="width: 200px; height: 200px; margin: 0 auto; background: conic-gradient(red 0deg 140deg, black 140deg 260deg, red 260deg 400deg, black 400deg 520deg, red 520deg 660deg, black 660deg 780deg, red 780deg 920deg, black 920deg 1040deg, red 1040deg 1180deg, black 1180deg 1300deg, red 130deg 1440deg, black 1440deg 1560deg, red 1560deg 1700deg, black 1700deg 1820deg, red 1820deg 1960deg, black 1960deg 2080deg, red 2080deg 2220deg, black 2220deg 2340deg, red 2340deg 2480deg, black 2480deg 2600deg, red 2600deg 2740deg, black 2740deg 2860deg, red 2860deg 3000deg, black 3000deg 3120deg, red 3120deg 3260deg, black 3260deg 3380deg, red 3380deg 3520deg, black 3520deg 3640deg); border-radius: 50%; position: relative;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: #FFD700; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #000;">
                                SPIN
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                        <button class="btn" style="background: #e74c3c;" onclick="selectRouletteBet('red')">RED</button>
                        <button class="btn" style="background: #2c3e50;" onclick="selectRouletteBet('black')">BLACK</button>
                        <button class="btn" style="background: #27ae60;" onclick="selectRouletteBet('green')">GREEN</button>
                        <button class="btn btn-outline" onclick="selectRouletteBet('odd')">ODD</button>
                        <button class="btn btn-outline" onclick="selectRouletteBet('even')">EVEN</button>
                        <button class="btn btn-outline" onclick="selectRouletteBet('low')">1-18</button>
                    </div>
                    
                    <button class="btn btn-success" onclick="spinRoulette()">
                        <i class="fas fa-play"></i>
                        Spin Roulette
                    </button>
                    
                    <div class="game-info">
                        <div class="game-stat">
                            <div class="game-stat-value" id="rouletteWins">${currentUser.gameStats?.roulette?.wins || 0}</div>
                            <div class="game-stat-label">Wins</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value" id="rouletteLosses">${currentUser.gameStats?.roulette?.losses || 0}</div>
                            <div class="game-stat-label">Losses</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value">${gameRTP.roulette}%</div>
                            <div class="game-stat-label">RTP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="backToHome()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Games
                    </button>
                </div>
            `;
        }

        function showMinesGame() {
            const gameContainer = document.getElementById('gameContainer');
            gameContainer.innerHTML = `
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-bomb"></i>
                        Mines
                    </div>
                    
                    <div class="game-controls">
                        <div class="bet-amount-container">
                            <input type="number" class="bet-amount-input" id="minesBet" value="10" min="1" max="${currentUser.balance || 0}">
                            <span>BTX</span>
                        </div>
                        <div class="bet-quick-select">
                            <button class="bet-quick-btn" onclick="setMinesBet(10)">10</button>
                            <button class="bet-quick-btn" onclick="setMinesBet(25)">25</button>
                            <button class="bet-quick-btn" onclick="setMinesBet(50)">50</button>
                            <button class="bet-quick-btn" onclick="setMinesBet(100)">100</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Number of Mines</label>
                        <select class="form-input" id="minesCount">
                            <option value="3">3 Mines</option>
                            <option value="5" selected>5 Mines</option>
                            <option value="10">10 Mines</option>
                            <option value="15">15 Mines</option>
                            <option value="20">20 Mines</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 20px;" id="minesGrid">
                        <!-- Mines grid will be generated here -->
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="startMinesGame()">
                            <i class="fas fa-play"></i>
                            Start Game
                        </button>
                        <button class="btn btn-warning" onclick="cashoutMines()" id="cashoutMinesBtn" disabled>
                            <i class="fas fa-coins"></i>
                            Cashout: <span id="cashoutMinesAmount">0</span> BTX
                        </button>
                    </div>
                    
                    <div class="game-info">
                        <div class="game-stat">
                            <div class="game-stat-value" id="minesWins">${currentUser.gameStats?.mines?.wins || 0}</div>
                            <div class="game-stat-label">Wins</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value" id="minesLosses">${currentUser.gameStats?.mines?.losses || 0}</div>
                            <div class="game-stat-label">Losses</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value">${gameRTP.mines}%</div>
                            <div class="game-stat-label">RTP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="backToHome()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Games
                    </button>
                </div>
            `;
            
            initializeMinesGrid();
        }

        function showDragonTowerGame() {
            const gameContainer = document.getElementById('gameContainer');
            gameContainer.innerHTML = `
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-dragon"></i>
                        Dragon Tower
                    </div>
                    
                    <div class="game-controls">
                        <div class="bet-amount-container">
                            <input type="number" class="bet-amount-input" id="dragonTowerBet" value="10" min="1" max="${currentUser.balance || 0}">
                            <span>BTX</span>
                        </div>
                        <div class="bet-quick-select">
                            <button class="bet-quick-btn" onclick="setDragonTowerBet(10)">10</button>
                            <button class="bet-quick-btn" onclick="setDragonTowerBet(25)">25</button>
                            <button class="bet-quick-btn" onclick="setDragonTowerBet(50)">50</button>
                            <button class="bet-quick-btn" onclick="setDragonTowerBet(100)">100</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 300px; margin: 0 auto;" id="dragonTowerGrid">
                            <!-- Tower levels will be generated here -->
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="startDragonTowerGame()">
                        <i class="fas fa-play"></i>
                        Start Game
                    </button>
                    
                    <div class="game-info">
                        <div class="game-stat">
                            <div class="game-stat-value" id="dragonTowerWins">${currentUser.gameStats?.['dragon-tower']?.wins || 0}</div>
                            <div class="game-stat-label">Wins</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value" id="dragonTowerLosses">${currentUser.gameStats?.['dragon-tower']?.losses || 0}</div>
                            <div class="game-stat-label">Losses</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value">${gameRTP['dragon-tower']}%</div>
                            <div class="game-stat-label">RTP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="backToHome()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Games
                    </button>
                </div>
            `;
            
            initializeDragonTowerGrid();
        }

        function showPlinkoGame() {
            const gameContainer = document.getElementById('gameContainer');
            gameContainer.innerHTML = `
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-circle"></i>
                        Plinko
                    </div>
                    
                    <div class="game-controls">
                        <div class="bet-amount-container">
                            <input type="number" class="bet-amount-input" id="plinkoBet" value="10" min="1" max="${currentUser.balance || 0}">
                            <span>BTX</span>
                        </div>
                        <div class="bet-quick-select">
                            <button class="bet-quick-btn" onclick="setPlinkoBet(10)">10</button>
                            <button class="bet-quick-btn" onclick="setPlinkoBet(25)">25</button>
                            <button class="bet-quick-btn" onclick="setPlinkoBet(50)">50</button>
                            <button class="bet-quick-btn" onclick="setPlinkoBet(100)">100</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <canvas id="plinkoCanvas" width="300" height="400" style="border: 1px solid var(--border-color); border-radius: 8px;"></canvas>
                    </div>
                    
                    <button class="btn btn-success" onclick="dropPlinkoBall()">
                        <i class="fas fa-play"></i>
                        Drop Ball
                    </button>
                    
                    <div class="game-info">
                        <div class="game-stat">
                            <div class="game-stat-value" id="plinkoWins">${currentUser.gameStats?.plinko?.wins || 0}</div>
                            <div class="game-stat-label">Wins</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value" id="plinkoLosses">${currentUser.gameStats?.plinko?.losses || 0}</div>
                            <div class="game-stat-label">Losses</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value">${gameRTP.plinko}%</div>
                            <div class="game-stat-label">RTP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="backToHome()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Games
                    </button>
                </div>
            `;
            
            initializePlinkoCanvas();
        }

        function showDiceGame() {
            const gameContainer = document.getElementById('gameContainer');
            gameContainer.innerHTML = `
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-dice"></i>
                        Dice
                    </div>
                    
                    <div class="game-controls">
                        <div class="bet-amount-container">
                            <input type="number" class="bet-amount-input" id="diceBet" value="10" min="1" max="${currentUser.balance || 0}">
                            <span>BTX</span>
                        </div>
                        <div class="bet-quick-select">
                            <button class="bet-quick-btn" onclick="setDiceBet(10)">10</button>
                            <button class="bet-quick-btn" onclick="setDiceBet(25)">25</button>
                            <button class="bet-quick-btn" onclick="setDiceBet(50)">50</button>
                            <button class="bet-quick-btn" onclick="setDiceBet(100)">100</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 80px; margin-bottom: 20px;" id="diceDisplay">ðŸŽ²</div>
                        <div class="form-group">
                            <label class="form-label">Choose Your Bet</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button class="btn" onclick="selectDiceBet('under')" id="diceUnderBtn">Under 50</button>
                                <button class="btn" onclick="selectDiceBet('over')" id="diceOverBtn">Over 50</button>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="rollDice()">
                        <i class="fas fa-play"></i>
                        Roll Dice
                    </button>
                    
                    <div class="game-info">
                        <div class="game-stat">
                            <div class="game-stat-value" id="diceWins">${currentUser.gameStats?.dice?.wins || 0}</div>
                            <div class="game-stat-label">Wins</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value" id="diceLosses">${currentUser.gameStats?.dice?.losses || 0}</div>
                            <div class="game-stat-label">Losses</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value">${gameRTP.dice}%</div>
                            <div class="game-stat-label">RTP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="backToHome()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Games
                    </button>
                </div>
            `;
        }

        function showDragonTigerGame() {
            const gameContainer = document.getElementById('gameContainer');
            gameContainer.innerHTML = `
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-dragon"></i>
                        Dragon Tiger
                    </div>
                    
                    <div class="game-controls">
                        <div class="bet-amount-container">
                            <input type="number" class="bet-amount-input" id="dragonTigerBet" value="10" min="1" max="${currentUser.balance || 0}">
                            <span>BTX</span>
                        </div>
                        <div class="bet-quick-select">
                            <button class="bet-quick-btn" onclick="setDragonTigerBet(10)">10</button>
                            <button class="bet-quick-btn" onclick="setDragonTigerBet(25)">25</button>
                            <button class="bet-quick-btn" onclick="setDragonTigerBet(50)">50</button>
                            <button class="bet-quick-btn" onclick="setDragonTigerBet(100)">100</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: var(--primary-color); margin-bottom: 10px;">Dragon</h4>
                                <div style="width: 100px; height: 140px; margin: 0 auto; background: rgba(255,215,0,0.1); border: 2px solid var(--primary-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 60px;" id="dragonCard">ðŸ‚ </div>
                            </div>
                            <div>
                                <h4 style="color: var(--danger-color); margin-bottom: 10px;">Tiger</h4>
                                <div style="width: 100px; height: 140px; margin: 0 auto; background: rgba(244,67,54,0.1); border: 2px solid var(--danger-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 60px;" id="tigerCard">ðŸ‚ </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                            <button class="btn" style="background: var(--gradient-primary);" onclick="selectDragonTigerBet('dragon')">Dragon</button>
                            <button class="btn" style="background: var(--gradient-secondary);" onclick="selectDragonTigerBet('tiger')">Tiger</button>
                            <button class="btn btn-outline" onclick="selectDragonTigerBet('tie')">Tie</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="playDragonTiger()">
                        <i class="fas fa-play"></i>
                        Deal Cards
                    </button>
                    
                    <div class="game-info">
                        <div class="game-stat">
                            <div class="game-stat-value" id="dragonTigerWins">${currentUser.gameStats?.['dragon-tiger']?.wins || 0}</div>
                            <div class="game-stat-label">Wins</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value" id="dragonTigerLosses">${currentUser.gameStats?.['dragon-tiger']?.losses || 0}</div>
                            <div class="game-stat-label">Losses</div>
                        </div>
                        <div class="game-stat">
                            <div class="game-stat-value">${gameRTP['dragon-tiger']}%</div>
                            <div class="game-stat-label">RTP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline" onclick="backToHome()" style="margin-top: 20px;">
                        <i class="fas fa-arrow-left"></i>
                        Back to Games
                    </button>
                </div>
            `;
        }

        // Game Implementation Functions
        let selectedRouletteBet = null;
        let selectedMinesCount = 5;
        let minesGameState = null;
        let dragonTowerGameState = null;
        let selectedDiceBet = null;
        let selectedDragonTigerBet = null;

        function setRouletteBet(amount) {
            document.getElementById('rouletteBet').value = amount;
        }

        function setMinesBet(amount) {
            document.getElementById('minesBet').value = amount;
        }

        function setDragonTowerBet(amount) {
            document.getElementById('dragonTowerBet').value = amount;
        }

        function setPlinkoBet(amount) {
            document.getElementById('plinkoBet').value = amount;
        }

        function setDiceBet(amount) {
            document.getElementById('diceBet').value = amount;
        }

        function setDragonTigerBet(amount) {
            document.getElementById('dragonTigerBet').value = amount;
        }

        function selectRouletteBet(type) {
            selectedRouletteBet = type;
            showToast(`Selected: ${type.toUpperCase()}`, 'success');
        }

        function selectDiceBet(type) {
            selectedDiceBet = type;
            
            // Update button styles
            document.getElementById('diceUnderBtn').classList.toggle('btn-success', type === 'under');
            document.getElementById('diceOverBtn').classList.toggle('btn-success', type === 'over');
            
            showToast(`Selected: ${type.toUpperCase()} 50`, 'success');
        }

        function selectDragonTigerBet(type) {
            selectedDragonTigerBet = type;
            showToast(`Selected: ${type.toUpperCase()}`, 'success');
        }

        function spinRoulette() {
            const betAmount = parseInt(document.getElementById('rouletteBet').value);
            
            if (!selectedRouletteBet) {
                showToast('Please select your bet type', 'warning');
                return;
            }
            
            if (betAmount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Simulate roulette spin
            const outcomes = ['red', 'black', 'green'];
            const weights = [18, 18, 1]; // 18 red, 18 black, 1 green (0)
            const result = weightedRandom(outcomes, weights);

            // Check win based on RTP
            const won = Math.random() < (gameRTP.roulette / 100);
            
            if (won && result === selectedRouletteBet) {
                let multiplier = 2;
                if (selectedRouletteBet === 'green') multiplier = 36;
                
                const winnings = betAmount * multiplier;
                updateBalance(winnings - betAmount);
                showToast(`You won ${winnings} BTX!`, 'success');
                updateGameStats('roulette', true, betAmount);
            } else {
                updateBalance(-betAmount);
                showToast(`You lost ${betAmount} BTX. Result: ${result.toUpperCase()}`, 'error');
                updateGameStats('roulette', false, betAmount);
            }
        }

        function initializeMinesGrid() {
            const grid = document.getElementById('minesGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('button');
                cell.className = 'btn btn-outline';
                cell.style.padding = '20px 10px';
                cell.style.fontSize = '20px';
                cell.innerHTML = 'ðŸŽ¯';
                cell.onclick = () => selectMineCell(i);
                cell.id = `mineCell${i}`;
                grid.appendChild(cell);
            }
        }

        function selectMineCell(index) {
            if (!minesGameState || minesGameState.gameOver) return;
            
            const cell = document.getElementById(`mineCell${index}`);
            if (minesGameState.revealed.includes(index)) return;
            
            minesGameState.revealed.push(index);
            
            if (minesGameState.mines.includes(index)) {
                cell.innerHTML = 'ðŸ’£';
                cell.style.background = 'var(--danger-color)';
                cell.disabled = true;
                minesGameState.gameOver = true;
                
                // Show all mines
                minesGameState.mines.forEach(mineIndex => {
                    const mineCell = document.getElementById(`mineCell${mineIndex}`);
                    mineCell.innerHTML = 'ðŸ’£';
                    mineCell.style.background = 'var(--danger-color)';
                });
                
                showToast('You hit a mine! Game over!', 'error');
                updateBalance(-minesGameState.betAmount);
                updateGameStats('mines', false, minesGameState.betAmount);
                document.getElementById('cashoutMinesBtn').disabled = true;
            } else {
                cell.innerHTML = 'ðŸ’Ž';
                cell.style.background = 'var(--success-color)';
                cell.disabled = true;
                
                // Update cashout amount
                minesGameState.safeReveals++;
                const multiplier = 1 + (minesGameState.safeReveals * 0.2);
                const cashoutAmount = Math.floor(minesGameState.betAmount * multiplier);
                document.getElementById('cashoutMinesAmount').textContent = cashoutAmount;
            }
        }

        function startMinesGame() {
            const betAmount = parseInt(document.getElementById('minesBet').value);
            const mineCount = parseInt(document.getElementById('minesCount').value);
            
            if (betAmount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Initialize game state
            minesGameState = {
                betAmount: betAmount,
                mineCount: mineCount,
                mines: [],
                revealed: [],
                safeReveals: 0,
                gameOver: false
            };

            // Generate random mine positions
            const positions = Array.from({length: 25}, (_, i) => i);
            for (let i = 0; i < mineCount; i++) {
                const randomIndex = Math.floor(Math.random() * positions.length);
                minesGameState.mines.push(positions.splice(randomIndex, 1)[0]);
            }

            // Reset grid
            initializeMinesGrid();
            
            // Enable cashout button
            document.getElementById('cashoutMinesBtn').disabled = false;
            document.getElementById('cashoutMinesAmount').textContent = betAmount;
            
            showToast('Game started! Click cells to reveal them', 'success');
        }

        function cashoutMines() {
            if (!minesGameState || minesGameState.gameOver) return;
            
            const multiplier = 1 + (minesGameState.safeReveals * 0.2);
            const cashoutAmount = Math.floor(minesGameState.betAmount * multiplier);
            const profit = cashoutAmount - minesGameState.betAmount;
            
            updateBalance(profit);
            showToast(`Cashout! You won ${cashoutAmount} BTX`, 'success');
            updateGameStats('mines', true, minesGameState.betAmount);
            
            minesGameState.gameOver = true;
            document.getElementById('cashoutMinesBtn').disabled = true;
        }

        function initializeDragonTowerGrid() {
            const grid = document.getElementById('dragonTowerGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const level = document.createElement('div');
                level.className = 'btn btn-outline';
                level.style.padding = '15px 10px';
                level.innerHTML = `Level ${i + 1}`;
                level.id = `towerLevel${i}`;
                level.onclick = () => selectTowerLevel(i);
                grid.appendChild(level);
            }
        }

        function startDragonTowerGame() {
            const betAmount = parseInt(document.getElementById('dragonTowerBet').value);
            
            if (betAmount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            dragonTowerGameState = {
                betAmount: betAmount,
                currentLevel: 0,
                gameOver: false
            };

            initializeDragonTowerGrid();
            showToast('Game started! Select your path', 'success');
        }

        function selectTowerLevel(levelIndex) {
            if (!dragonTowerGameState || dragonTowerGameState.gameOver) return;
            
            // Random win/loss based on level and RTP
            const levelDifficulty = (levelIndex + 1) / 9;
            const winChance = (gameRTP['dragon-tower'] / 100) * (1 - levelDifficulty);
            
            if (Math.random() < winChance) {
                // Win this level
                const levelElement = document.getElementById(`towerLevel${levelIndex}`);
                levelElement.innerHTML = 'âœ…';
                levelElement.style.background = 'var(--success-color)';
                levelElement.disabled = true;
                
                dragonTowerGameState.currentLevel = levelIndex + 1;
                
                if (levelIndex === 8) {
                    // Completed all levels
                    const winnings = Math.floor(dragonTowerGameState.betAmount * 10);
                    updateBalance(winnings - dragonTowerGameState.betAmount);
                    showToast(`Amazing! You completed all levels and won ${winnings} BTX!`, 'success');
                    updateGameStats('dragon-tower', true, dragonTowerGameState.betAmount);
                    dragonTowerGameState.gameOver = true;
                } else {
                    showToast(`Level ${levelIndex + 1} completed! Continue to the next level.`, 'success');
                }
            } else {
                // Lose
                const levelElement = document.getElementById(`towerLevel${levelIndex}`);
                levelElement.innerHTML = 'âŒ';
                levelElement.style.background = 'var(--danger-color)';
                levelElement.disabled = true;
                
                showToast(`You failed at level ${levelIndex + 1}!`, 'error');
                updateBalance(-dragonTowerGameState.betAmount);
                updateGameStats('dragon-tower', false, dragonTowerGameState.betAmount);
                dragonTowerGameState.gameOver = true;
            }
        }

        function initializePlinkoCanvas() {
            const canvas = document.getElementById('plinkoCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Draw pegs
            ctx.fillStyle = '#FFD700';
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col <= row; col++) {
                    const x = 150 + (col - row/2) * 30;
                    const y = 50 + row * 40;
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // Draw buckets with multipliers
            const bucketMultipliers = [0.5, 1, 1.5, 2, 3, 2, 1.5, 1, 0.5];
            for (let i = 0; i < 9; i++) {
                const x = 60 + i * 30;
                ctx.fillStyle = bucketMultipliers[i] >= 2 ? '#4caf50' : '#e74c3c';
                ctx.fillRect(x, 350, 25, 40);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${bucketMultipliers[i]}x`, x + 12.5, 375);
            }
        }

        function dropPlinkoBall() {
            const betAmount = parseInt(document.getElementById('plinkoBet').value);
            
            if (betAmount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Simulate plinko result
            const bucketMultipliers = [0.5, 1, 1.5, 2, 3, 2, 1.5, 1, 0.5];
            const resultIndex = Math.floor(Math.random() * 9);
            const multiplier = bucketMultipliers[resultIndex];
            
            // Apply RTP logic
            const won = Math.random() < (gameRTP.plinko / 100);
            
            if (won && multiplier > 1) {
                const winnings = Math.floor(betAmount * multiplier);
                updateBalance(winnings - betAmount);
                showToast(`Ball landed in ${multiplier}x bucket! You won ${winnings} BTX!`, 'success');
                updateGameStats('plinko', true, betAmount);
            } else {
                updateBalance(-betAmount);
                showToast(`Ball landed in ${multiplier}x bucket. You lost ${betAmount} BTX.`, 'error');
                updateGameStats('plinko', false, betAmount);
            }
        }

        function rollDice() {
            const betAmount = parseInt(document.getElementById('diceBet').value);
            
            if (!selectedDiceBet) {
                showToast('Please select under or over 50', 'warning');
                return;
            }
            
            if (betAmount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Roll dice (1-100)
            const diceValue = Math.floor(Math.random() * 100) + 1;
            const diceDisplay = document.getElementById('diceDisplay');
            
            // Animate dice roll
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                diceDisplay.textContent = ['ðŸŽ²', 'ðŸŽ¯', 'ðŸŽª', 'ðŸŽ°', 'ðŸŽ²'][rollCount % 5];
                rollCount++;
                
                if (rollCount > 10) {
                    clearInterval(rollInterval);
                    diceDisplay.textContent = `ðŸŽ² ${diceValue}`;
                    
                    // Check win
                    const won = (selectedDiceBet === 'under' && diceValue < 50) || 
                                (selectedDiceBet === 'over' && diceValue > 50);
                    
                    if (won) {
                        const winnings = Math.floor(betAmount * 2);
                        updateBalance(winnings - betAmount);
                        showToast(`Dice rolled ${diceValue}! You won ${winnings} BTX!`, 'success');
                        updateGameStats('dice', true, betAmount);
                    } else {
                        updateBalance(-betAmount);
                        showToast(`Dice rolled ${diceValue}! You lost ${betAmount} BTX.`, 'error');
                        updateGameStats('dice', false, betAmount);
                    }
                }
            }, 100);
        }

        function playDragonTiger() {
            const betAmount = parseInt(document.getElementById('dragonTigerBet').value);
            
            if (!selectedDragonTigerBet) {
                showToast('Please select dragon, tiger, or tie', 'warning');
                return;
            }
            
            if (betAmount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            // Generate random cards (1-13, where Ace=1, J=11, Q=12, K=13)
            const dragonValue = Math.floor(Math.random() * 13) + 1;
            const tigerValue = Math.floor(Math.random() * 13) + 1;
            
            const cardSymbols = ['ðŸ‚¡', 'ðŸ‚¢', 'ðŸ‚£', 'ðŸ‚¤', 'ðŸ‚¥', 'ðŸ‚¦', 'ðŸ‚§', 'ðŸ‚¨', 'ðŸ‚©', 'ðŸ‚ª', 'ðŸ‚«', 'ðŸ‚¬', 'ðŸ‚­', 'ðŸ‚®'];
            
            document.getElementById('dragonCard').textContent = cardSymbols[dragonValue];
            document.getElementById('tigerCard').textContent = cardSymbols[tigerValue];
            
            let result;
            if (dragonValue > tigerValue) {
                result = 'dragon';
            } else if (tigerValue > dragonValue) {
                result = 'tiger';
            } else {
                result = 'tie';
            }
            
            if (result === selectedDragonTigerBet) {
                let multiplier = 2;
                if (result === 'tie') multiplier = 8;
                
                const winnings = Math.floor(betAmount * multiplier);
                updateBalance(winnings - betAmount);
                showToast(`${result.toUpperCase()} wins! You won ${winnings} BTX!`, 'success');
                updateGameStats('dragon-tiger', true, betAmount);
            } else {
                updateBalance(-betAmount);
                showToast(`${result.toUpperCase()} wins! You lost ${betAmount} BTX.`, 'error');
                updateGameStats('dragon-tiger', false, betAmount);
            }
        }

        function backToHome() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('homeScreen').classList.add('active');
            currentGame = null;
        }

        // Helper Functions
        function weightedRandom(items, weights) {
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < items.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    return items[i];
                }
            }
            
            return items[items.length - 1];
        }

        function updateBalance(amount) {
            currentUser.balance += amount;
            if (amount > 0) {
                currentUser.totalEarned += amount;
            }
            
            database.ref('users/' + currentUser.id).update({
                balance: currentUser.balance,
                totalEarned: currentUser.totalEarned
            });
            
            updateUserInterface();
        }

        function updateGameStats(game, won, betAmount) {
            const stats = currentUser.gameStats || {};
            if (!stats[game]) {
                stats[game] = { wins: 0, losses: 0, totalBet: 0 };
            }
            
            stats[game].totalBet += betAmount;
            if (won) {
                stats[game].wins++;
            } else {
                stats[game].losses++;
            }
            
            currentUser.statistics.gamesPlayed++;
            
            database.ref('users/' + currentUser.id).update({
                gameStats: stats,
                'statistics.gamesPlayed': currentUser.statistics.gamesPlayed
            });
            
            updateUserInterface();
        }

        // Daily Check-in Functions
        function checkDailyCheckin() {
            const today = new Date().toDateString();
            const lastCheckin = currentUser.lastCheckin ? new Date(currentUser.lastCheckin).toDateString() : null;
            
            if (today !== lastCheckin) {
                showCheckinModal();
            }
        }

        function showCheckinModal() {
            const modal = document.getElementById('checkinModal');
            const progressContainer = document.getElementById('checkinProgress');
            const rewardDiv = document.getElementById('checkinReward');
            
            // Calculate current streak
            let currentDay = 1;
            if (currentUser.lastCheckin) {
                const lastCheckin = new Date(currentUser.lastCheckin);
                const today = new Date();
                const daysDiff = Math.floor((today - lastCheckin) / (1000 * 60 * 60 * 24));
                
                if (daysDiff === 1) {
                    currentDay = (currentUser.checkinStreak || 0) + 1;
                    if (currentDay > 7) currentDay = 1;
                }
            }
            
            // Generate progress days
            progressContainer.innerHTML = '';
            for (let i = 1; i <= 7; i++) {
                const dayItem = document.createElement('div');
                dayItem.className = 'day-item';
                
                let circleClass = 'pending';
                if (i < currentDay) {
                    circleClass = 'completed';
                } else if (i === currentDay) {
                    circleClass = 'current';
                }
                
                dayItem.innerHTML = `
                    <div class="day-circle ${circleClass}">${i}</div>
                    <div class="day-label">Day ${i}</div>
                `;
                
                progressContainer.appendChild(dayItem);
            }
            
            // Show reward
            rewardDiv.innerHTML = `
                <i class="fas fa-gift"></i>
                Today's Reward: ${currentDay} BTX
            `;
            
            // Store current day for claiming
            window.currentCheckinDay = currentDay;
            
            modal.classList.add('active');
        }

        function closeCheckinModal() {
            document.getElementById('checkinModal').classList.remove('active');
        }

        function claimCheckinReward() {
            const reward = window.currentCheckinDay || 1;
            
            // Update user data
            const updates = {
                lastCheckin: new Date().toISOString(),
                checkinStreak: reward,
                balance: firebase.database.ServerValue.increment(reward),
                totalEarned: firebase.database.ServerValue.increment(reward)
            };
            
            database.ref('users/' + currentUser.id).update(updates).then(() => {
                currentUser.lastCheckin = new Date().toISOString();
                currentUser.checkinStreak = reward;
                currentUser.balance += reward;
                currentUser.totalEarned += reward;
                
                updateUserInterface();
                closeCheckinModal();
                
                showToast(`Daily check-in claimed! ${reward} BTX added to your balance`, 'success');
                
                // Send bot notification for milestone
                if (reward === 7) {
                    sendBotNotification(`${currentUser.name} completed a 7-day check-in streak!`);
                }
            }).catch((error) => {
                console.error('Error claiming check-in:', error);
                showToast('Failed to claim reward', 'error');
            });
        }

        // Navigation Functions
        function showScreen(screenName) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenName + 'Screen').classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Update bottom nav
            const navItem = Array.from(document.querySelectorAll('.nav-item')).find(item => 
                item.getAttribute('onclick').includes(screenName)
            );
            if (navItem) {
                navItem.classList.add('active');
            }
            
            currentScreen = screenName;
            
            // Load screen-specific data
            switch(screenName) {
                case 'discover':
                    loadPosts();
                    break;
                case 'earn':
                    loadTasks();
                    updateEarnStats();
                    break;
                case 'wallet':
                    loadTransactions();
                    updateWalletSection();
                    break;
                case 'profile':
                    updateProfileSection();
                    updateProfileStats();
                    updateSettingsSection();
                    break;
            }
        }

        // Discover/Posts Functions
        function createPost() {
            const content = document.getElementById('postContent').value.trim();
            
            if (!content) {
                showToast('Please write something for your post', 'warning');
                return;
            }

            const post = {
                id: Date.now(),
                userId: currentUser.id,
                userName: currentUser.name,
                userPhoto: currentUser.photo_url,
                content: content,
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: []
            };

            database.ref('posts/' + post.id).set(post).then(() => {
                document.getElementById('postContent').value = '';
                showToast('Post created successfully!', 'success');
                currentUser.statistics.postsCreated++;
                database.ref('users/' + currentUser.id + '/statistics/postsCreated').set(currentUser.statistics.postsCreated);
                loadPosts();
            }).catch((error) => {
                console.error('Error creating post:', error);
                showToast('Failed to create post', 'error');
            });
        }

        function loadPosts() {
            const postsList = document.getElementById('postsList');
            if (!postsList) return;

            database.ref('posts').orderByChild('timestamp').limitToLast(20).once('value').then((snapshot) => {
                postsList.innerHTML = '';
                
                const posts = [];
                snapshot.forEach((childSnapshot) => {
                    posts.unshift(childSnapshot.val());
                });

                posts.forEach(post => {
                    const postCard = document.createElement('div');
                    postCard.className = 'card';
                    postCard.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <img src="${post.userPhoto || 'https://via.placeholder.com/40'}" 
                                 style="width: 40px; height: 40px; border-radius: 50%;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">${post.userName}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(post.timestamp)}</div>
                            </div>
                        </div>
                        <p style="margin-bottom: 15px; color: var(--text-primary);">${post.content}</p>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-sm btn-outline" onclick="likePost(${post.id})">
                                <i class="fas fa-heart"></i>
                                ${post.likes}
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="commentOnPost(${post.id})">
                                <i class="fas fa-comment"></i>
                                ${post.comments.length}
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="sharePost(${post.id})">
                                <i class="fas fa-share"></i>
                                Share
                            </button>
                        </div>
                    `;
                    postsList.appendChild(postCard);
                });

                if (posts.length === 0) {
                    postsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No posts yet. Be the first to share!</p>';
                }
            }).catch((error) => {
                console.error('Error loading posts:', error);
            });
        }

        function likePost(postId) {
            const postRef = database.ref('posts/' + postId);
            
            postRef.transaction((post) => {
                if (post) {
                    post.likes = (post.likes || 0) + 1;
                }
                return post;
            }).then(() => {
                showToast('Post liked!', 'success');
                loadPosts();
            }).catch((error) => {
                console.error('Error liking post:', error);
            });
        }

        function commentOnPost(postId) {
            const comment = prompt('Write your comment:');
            
            if (!comment || !comment.trim()) return;

            const commentData = {
                userId: currentUser.id,
                userName: currentUser.name,
                content: comment.trim(),
                timestamp: new Date().toISOString()
            };

            database.ref('posts/' + postId + '/comments').push(commentData).then(() => {
                showToast('Comment added!', 'success');
                loadPosts();
            }).catch((error) => {
                console.error('Error adding comment:', error);
            });
        }

        function sharePost(postId) {
            // Copy post link to clipboard
            const postUrl = `https://t.me/tgwinarena_bot?start=post_${postId}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(postUrl).then(() => {
                    showToast('Post link copied to clipboard!', 'success');
                });
            } else {
                showToast('Post link: ' + postUrl, 'success');
            }
        }

        // Earn Functions
        function watchAd() {
            const adReward = 0.10;
            
            // Simulate ad watching
            showToast('Starting ad...', 'info');
            
            setTimeout(() => {
                updateBalance(adReward);
                currentUser.statistics.adsWatched++;
                
                database.ref('users/' + currentUser.id).update({
                    balance: currentUser.balance,
                    'statistics.adsWatched': currentUser.statistics.adsWatched
                });
                
                showToast(`Ad watched! ${adReward} BTX added to your balance`, 'success');
                updateEarnStats();
            }, 2000);
        }

        function loadTasks() {
            const tasksList = document.getElementById('tasksList');
            if (!tasksList) return;

            const tasks = [
                {
                    id: 1,
                    title: 'Join our Telegram channel',
                    description: 'Join our official Telegram channel for updates',
                    reward: 5,
                    url: 'https://t.me/tgwinarena_channel'
                },
                {
                    id: 2,
                    title: 'Follow us on Twitter',
                    description: 'Follow our Twitter account for latest news',
                    reward: 3,
                    url: 'https://twitter.com/tgwinarena'
                },
                {
                    id: 3,
                    title: 'Invite 5 friends',
                    description: 'Invite 5 friends to join TG WinArena',
                    reward: 25,
                    url: null
                }
            ];

            tasksList.innerHTML = '';
            
            tasks.forEach(task => {
                const taskCard = document.createElement('div');
                taskCard.className = 'card';
                taskCard.style.marginBottom = '10px';
                taskCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 5px;">${task.title}</h4>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">${task.description}</p>
                            <span style="color: var(--success-color); font-weight: 600;">+${task.reward} BTX</span>
                        </div>
                        <button class="btn btn-sm" onclick="completeTask(${task.id}, '${task.url}')">
                            <i class="fas fa-external-link-alt"></i>
                            Complete
                        </button>
                    </div>
                `;
                tasksList.appendChild(taskCard);
            });
        }

        function completeTask(taskId, taskUrl) {
            if (taskUrl) {
                // Open external link
                telegram.openLink(taskUrl);
                
                // Start timer for verification
                showToast('Task opened! Complete the task and return to claim reward.', 'info');
                
                setTimeout(() => {
                    if (confirm('Have you completed the task?')) {
                        const taskReward = taskId === 1 ? 5 : (taskId === 2 ? 3 : 25);
                        updateBalance(taskReward);
                        currentUser.statistics.tasksCompleted++;
                        
                        database.ref('users/' + currentUser.id).update({
                            balance: currentUser.balance,
                            'statistics.tasksCompleted': currentUser.statistics.tasksCompleted
                        });
                        
                        showToast(`Task completed! ${taskReward} BTX added to your balance`, 'success');
                        updateEarnStats();
                    }
                }, 30000); // Wait 30 seconds
            } else {
                // Internal task (like referrals)
                showReferralSection();
            }
        }

        function updateEarnStats() {
            const today = new Date().toDateString();
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            
            // This would normally be calculated from user's ad watching history
            // For now, showing current statistics
            document.getElementById('adsToday').textContent = currentUser.statistics?.adsWatched || 0;
            document.getElementById('adsWeek').textContent = currentUser.statistics?.adsWatched || 0;
            document.getElementById('adsTotal').textContent = currentUser.statistics?.adsWatched || 0;
        }

        // Wallet Functions
        function initializeTonConnect() {
            if (tonConnectUI) return;
            
            tonConnectUI = new TON_CONNECT_UI({
                manifestUrl: 'https://tgwinarena.example.com/tonconnect-manifest.json',
                buttonRootId: null
            });
        }

        function connectWallet() {
            if (!tonConnectUI) {
                initializeTonConnect();
            }
            
            tonConnectUI.connectWallet().then((wallet) => {
                currentUser.walletConnected = true;
                currentUser.walletAddress = wallet.account.address;
                
                database.ref('users/' + currentUser.id).update({
                    walletConnected: true,
                    walletAddress: wallet.account.address
                });
                
                updateWalletSection();
                showToast('Wallet connected successfully!', 'success');
            }).catch((error) => {
                console.error('Error connecting wallet:', error);
                showToast('Failed to connect wallet', 'error');
            });
        }

        function disconnectWallet() {
            if (tonConnectUI) {
                tonConnectUI.disconnect();
                
                currentUser.walletConnected = false;
                currentUser.walletAddress = null;
                
                database.ref('users/' + currentUser.id).update({
                    walletConnected: false,
                    walletAddress: null
                });
                
                updateWalletSection();
                showToast('Wallet disconnected', 'info');
            }
        }

        function updateWalletSection() {
            const walletConnection = document.getElementById('walletConnection');
            if (!walletConnection) return;

            if (currentUser.walletConnected) {
                walletConnection.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="color: var(--success-color); font-size: 48px; margin-bottom: 10px;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4 style="color: var(--text-primary); margin-bottom: 5px;">Wallet Connected</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">
                            ${currentUser.walletAddress?.substring(0, 6)}...${currentUser.walletAddress?.substring(-4)}
                        </p>
                        <button class="btn btn-danger btn-sm" onclick="disconnectWallet()">
                            <i class="fas fa-unlink"></i>
                            Disconnect
                        </button>
                    </div>
                `;
            } else {
                walletConnection.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="color: var(--text-secondary); font-size: 48px; margin-bottom: 10px;">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <h4 style="color: var(--text-primary); margin-bottom: 5px;">Connect Your TON Wallet</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">
                            Connect your wallet to deposit and withdraw BTX tokens
                        </p>
                        <button class="btn" onclick="connectWallet()">
                            <i class="fas fa-link"></i>
                            Connect Wallet
                        </button>
                    </div>
                `;
            }
        }

        function deposit() {
            if (!currentUser.walletConnected) {
                showToast('Please connect your wallet first', 'warning');
                return;
            }

            showToast('Deposit feature coming soon!', 'info');
        }

        function withdraw() {
            if (!currentUser.walletConnected) {
                showToast('Please connect your wallet first', 'warning');
                return;
            }

            if (currentUser.balance < 250) {
                showToast('Minimum withdrawal amount is 250 BTX', 'warning');
                return;
            }

            const withdrawAmount = prompt('Enter amount to withdraw (BTX):');
            
            if (!withdrawAmount || isNaN(withdrawAmount)) {
                showToast('Invalid amount', 'error');
                return;
            }

            const amount = parseFloat(withdrawAmount);
            
            if (amount > currentUser.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            if (amount < 250) {
                showToast('Minimum withdrawal amount is 250 BTX', 'warning');
                return;
            }

            // Create withdrawal request
            const withdrawal = {
                id: Date.now(),
                userId: currentUser.id,
                amount: amount,
                address: currentUser.walletAddress,
                status: 'pending',
                timestamp: new Date().toISOString()
            };

            database.ref('withdrawals/' + withdrawal.id).set(withdrawal).then(() => {
                updateBalance(-amount);
                showToast(`Withdrawal request for ${amount} BTX submitted successfully!`, 'success');
                loadTransactions();
            }).catch((error) => {
                console.error('Error creating withdrawal:', error);
                showToast('Failed to submit withdrawal request', 'error');
            });
        }

        function loadTransactions() {
            const transactionsList = document.getElementById('transactionsList');
            if (!transactionsList) return;

            database.ref('withdrawals').orderByChild('userId').equalTo(currentUser.id).limitToLast(10).once('value').then((snapshot) => {
                transactionsList.innerHTML = '';
                
                const transactions = [];
                snapshot.forEach((childSnapshot) => {
                    transactions.unshift(childSnapshot.val());
                });

                if (transactions.length === 0) {
                    transactionsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No transactions yet</p>';
                    return;
                }

                transactions.forEach(transaction => {
                    const statusColor = transaction.status === 'completed' ? 'var(--success-color)' : 
                                      transaction.status === 'pending' ? 'var(--warning-color)' : 
                                      'var(--danger-color)';
                    
                    const transactionCard = document.createElement('div');
                    transactionCard.className = 'card';
                    transactionCard.style.marginBottom = '10px';
                    transactionCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">
                                    Withdrawal: ${transaction.amount} BTX
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);">
                                    ${formatDate(transaction.timestamp)}
                                </div>
                            </div>
                            <span style="color: ${statusColor}; font-weight: 600; text-transform: capitalize;">
                                ${transaction.status}
                            </span>
                        </div>
                    `;
                    transactionsList.appendChild(transactionCard);
                });
            }).catch((error) => {
                console.error('Error loading transactions:', error);
            });
        }

        // Profile Functions
        function updateProfileStats() {
            const profileStats = document.getElementById('profileStats');
            if (!profileStats) return;

            const joinedDate = new Date(currentUser.joined).toLocaleDateString();
            const daysActive = Math.floor((new Date() - new Date(currentUser.joined)) / (1000 * 60 * 60 * 24));

            profileStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="color: var(--primary-color); font-weight: 600; font-size: 18px;">${currentUser.statistics?.gamesPlayed || 0}</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Games Played</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="color: var(--primary-color); font-weight: 600; font-size: 18px;">${currentUser.statistics?.adsWatched || 0}</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Ads Watched</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="color: var(--primary-color); font-weight: 600; font-size: 18px;">${currentUser.statistics?.tasksCompleted || 0}</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Tasks Completed</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <div style="color: var(--primary-color); font-weight: 600; font-size: 18px;">${currentUser.statistics?.postsCreated || 0}</div>
                        <div style="color: var(--text-secondary); font-size: 12px;">Posts Created</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: var(--text-secondary);">Member Since</span>
                        <span style="color: var(--text-primary); font-weight: 600;">${joinedDate}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: var(--text-secondary);">Days Active</span>
                        <span style="color: var(--text-primary); font-weight: 600;">${daysActive}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Check-in Streak</span>
                        <span style="color: var(--text-primary); font-weight: 600;">${currentUser.checkinStreak || 0} days</span>
                    </div>
                </div>
            `;
        }

        function updateSettingsSection() {
            const profileSettings = document.getElementById('profileSettings');
            if (!profileSettings) return;

            profileSettings.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: var(--text-primary); font-weight: 600;">Sound Effects</div>
                            <div style="color: var(--text-secondary); font-size: 12px;">Enable game sounds</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${currentUser.settings?.sound ? 'checked' : ''} onchange="toggleSetting('sound', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: var(--text-primary); font-weight: 600;">Notifications</div>
                            <div style="color: var(--text-secondary); font-size: 12px;">Receive push notifications</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${currentUser.settings?.notifications ? 'checked' : ''} onchange="toggleSetting('notifications', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: var(--text-primary); font-weight: 600;">Dark Mode</div>
                            <div style="color: var(--text-secondary); font-size: 12px;">Toggle dark theme</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" ${currentUser.settings?.darkMode ? 'checked' : ''} onchange="toggleSetting('darkMode', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <button class="btn btn-danger" onclick="deleteAccount()" style="width: 100%;">
                        <i class="fas fa-trash"></i>
                        Delete Account
                    </button>
                </div>
            `;
        }

        function toggleSetting(setting, value) {
            currentUser.settings[setting] = value;
            
            database.ref('users/' + currentUser.id + '/settings/' + setting).set(value).then(() => {
                showToast(`${setting.charAt(0).toUpperCase() + setting.slice(1)} ${value ? 'enabled' : 'disabled'}`, 'success');
                
                if (setting === 'darkMode') {
                    document.body.classList.toggle('dark-mode', value);
                }
            }).catch((error) => {
                console.error('Error updating setting:', error);
                showToast('Failed to update setting', 'error');
            });
        }

        function deleteAccount() {
            if (!confirm('Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently deleted.')) {
                return;
            }

            if (!confirm('This will permanently delete your account, balance, game statistics, and all associated data. Are you absolutely sure?')) {
                return;
            }

            database.ref('users/' + currentUser.id).remove().then(() => {
                showToast('Account deleted successfully', 'success');
                setTimeout(() => {
                    telegram.close();
                }, 2000);
            }).catch((error) => {
                console.error('Error deleting account:', error);
                showToast('Failed to delete account', 'error');
            });
        }

        // Referral Functions
        function showReferralSection() {
            const referralLink = `https://t.me/tgwinarena_bot?start=${currentUser.id}`;
            
            showToast(`Your referral link: ${referralLink}`, 'info');
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(referralLink).then(() => {
                    showToast('Referral link copied to clipboard!', 'success');
                });
            }
        }

        function loadReferrals() {
            // This would load referral statistics
            // For now, just ensure the function exists
        }

        // Search and Filter Functions
        function searchGames() {
            const searchTerm = document.getElementById('gameSearch').value.toLowerCase();
            const gameCards = document.querySelectorAll('.casino-game-card');
            
            gameCards.forEach(card => {
                const title = card.querySelector('.casino-game-title').textContent.toLowerCase();
                const description = card.querySelector('.casino-game-description').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterByCategory(category) {
            // Update active category chip
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const gameCards = document.querySelectorAll('.casino-game-card');
            
            gameCards.forEach(card => {
                const gameTitle = card.querySelector('.casino-game-title').textContent.toLowerCase();
                const game = gamesData.find(g => g.title.toLowerCase() === gameTitle);
                
                if (game) {
                    if (category === 'all') {
                        card.style.display = 'block';
                    } else if (category === 'popular' && game.popular) {
                        card.style.display = 'block';
                    } else if (category === 'new' && game.new) {
                        card.style.display = 'block';
                    } else if (game.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        function sortGames() {
            const sortBy = document.getElementById('sortSelect').value;
            const gamesList = document.getElementById('gamesList');
            
            let sortedGames = [...gamesData];
            
            switch(sortBy) {
                case 'popular':
                    sortedGames.sort((a, b) => {
                        const aPlayers = parseInt(a.players.replace(/[^\d]/g, ''));
                        const bPlayers = parseInt(b.players.replace(/[^\d]/g, ''));
                        return bPlayers - aPlayers;
                    });
                    break;
                case 'rtp':
                    sortedGames.sort((a, b) => b.rtp - a.rtp);
                    break;
                case 'new':
                    sortedGames.sort((a, b) => (b.new ? 1 : 0) - (a.new ? 1 : 0));
                    break;
                case 'trending':
                    // Simple trending: new + popular
                    sortedGames.sort((a, b) => {
                        const aScore = (a.new ? 100 : 0) + parseInt(a.players.replace(/[^\d]/g, ''));
                        const bScore = (b.new ? 100 : 0) + parseInt(b.players.replace(/[^\d]/g, ''));
                        return bScore - aScore;
                    });
                    break;
            }
            
            // Reload games with sorted order
            gamesList.innerHTML = '';
            sortedGames.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'casino-game-card';
                gameCard.onclick = () => openGame(game.id);
                
                gameCard.innerHTML = `
                    <div class="casino-game-icon">${game.icon}</div>
                    <div class="casino-game-title">${game.title}</div>
                    <div class="casino-game-description">${game.description}</div>
                    <div class="casino-game-stats">
                        <span class="casino-game-players">ðŸ”¥ ${game.players}</span>
                        <span class="casino-game-rtp">RTP: ${game.rtp}%</span>
                    </div>
                    <button class="btn btn-sm">
                        <i class="fas fa-play"></i>
                        Play Now
                    </button>
                `;
                
                gamesList.appendChild(gameCard);
            });
        }

        // Utility Functions
        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) {
                return 'Just now';
            } else if (diff < 3600000) {
                return Math.floor(diff / 60000) + ' minutes ago';
            } else if (diff < 86400000) {
                return Math.floor(diff / 3600000) + ' hours ago';
            } else if (diff < 604800000) {
                return Math.floor(diff / 86400000) + ' days ago';
            } else {
                return date.toLocaleDateString();
            }
        }

        function sendBotNotification(message) {
            // This would send a notification to the Telegram bot
            // For now, just log it
            console.log('Bot notification:', message);
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateStats() {
            // Update various statistics
            updateEarnStats();
        }

        // Handle image upload for posts
        function handleImageUpload(event) {
            const file = event.target.files[0];
            
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('Image size must be less than 5MB', 'error');
                return;
            }

            showToast('Image selected', 'success');
        }

        // Add toggle switch styles
        const style = document.createElement('style');
        style.textContent = `
            .switch {
                position: relative;
                display: inline-block;
                width: 50px;
                height: 24px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(255, 255, 255, 0.2);
                transition: .4s;
                border-radius: 24px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }
            
            input:checked + .slider {
                background-color: var(--primary-color);
            }
            
            input:checked + .slider:before {
                transform: translateX(26px);
            }
        `;
        document.head.appendChild(style);

        // Touch event handling for mobile
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
